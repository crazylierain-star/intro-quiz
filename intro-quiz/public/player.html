<!DOCTYPE html>
<html>
<body>
<h1>早押し</h1>
<input id="name" placeholder="名前">
<button id="buzz">押す</button>
<div id="status"></div>

<script>
const sessionId =
  new URLSearchParams(location.search).get("sessionId");

const ws = new WebSocket(
  (location.protocol === "https:" ? "wss://" : "ws://")
  + location.host
);

buzz.onclick = () => {
  ws.send(JSON.stringify({
    type: "buzz",
    sessionId,
    user: name.value || "名無し"
  }));
};

ws.onmessage = e => {
  const d = JSON.parse(e.data);
  if (d.type === "buzzed") {
    status.textContent =
      `${d.winner} さんが先です`;
  }
  if (d.type === "resume") {
    status.textContent = "次の問題";
  }
};
</script>
</body>
</html>
